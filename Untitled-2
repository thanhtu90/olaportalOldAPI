SELECT
    accounts.id,
    accounts.companyname AS business,
    COUNT(DISTINCT jo.id) AS transactions,
    SUM(
        CASE WHEN JSON_UNQUOTE(
            JSON_EXTRACT(jo.content, '$.trans_type')
        ) = 'Refund' THEN CAST(
            JSON_UNQUOTE(
                JSON_EXTRACT(jo.content, '$.amount')
            ) AS DECIMAL(10, 2)
        ) ELSE 0
    END
) AS refund,
SUM(
    CAST(
        JSON_UNQUOTE(
            JSON_EXTRACT(jo.content, '$.amount')
        ) AS DECIMAL(10, 2)
    )
) AS amount
FROM
    json j
JOIN terminals ON terminals.id = j.serial
JOIN accounts ON terminals.vendors_id = accounts.id
JOIN jsonOlaPay jo ON
    CAST(JSON_UNQUOTE(
        JSON_EXTRACT(jo.content, '$.trans_id')
    ) AS CHAR) = 
    CAST(JSON_VALUE(
        JSON_UNQUOTE(JSON_EXTRACT(j.content, '$.payments')),
        '$[0].olapayApprovalId'
    ) AS CHAR)
WHERE
    jo.lastmod >= '2025-01-06 18:00:00'
GROUP BY
    terminals.vendors_id
ORDER BY
    amount DESC
LIMIT 10